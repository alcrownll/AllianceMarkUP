@using static ASI.Basecode.Resources.Views.Screen
@using ASI.Basecode.Services.ServiceModels
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>

    <!-- Bootstrap + Site Styles -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">
    <link rel="stylesheet" href="~/css/main-site.css" />

    <!-- Hover label (global) -->
    <link rel="stylesheet" href="~/css/hover-label.css" />

    <!-- For Mini Calendar -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script>
        (function () {
          function loadInto(el) {
            if (!el) return;
            var url = el.getAttribute('data-url');
            if (!url) return;

            fetch(url, { credentials: 'same-origin' })
              .then(r => r.text())
              .then(html => {
                el.innerHTML = html;
                var input = el.querySelector('#miniCalendar');
                if (input && window.flatpickr) flatpickr(input, { inline: true });
              })
              .catch(() => { el.innerHTML = '<div class="p-3 text-danger small">Failed to load.</div>'; });
          }
          document.addEventListener('DOMContentLoaded', function () {
            loadInto(document.getElementById('rightSidebar'));
          });
        })();
    </script>

    @RenderSection("Styles", required: false)
</head>
<body>

    <!-- Page layout container -->
    <div class="layout-container d-flex">
        <!-- LEFT SIDEBAR (Role-based Navigation) -->
        <aside class="left-sidebar">
            @if (User != null && User.IsInRole("Student"))
            {
                @await Html.PartialAsync("Sidebars/_LeftSidebarStudent")
            }
            else if (User != null && User.IsInRole("Teacher"))
            {
                @await Html.PartialAsync("Sidebars/_LeftSidebarTeacher")
            }
            else if (User != null && User.IsInRole("Admin"))
            {
                @await Html.PartialAsync("Sidebars/_LeftSidebarAdmin")
            }
        </aside>

        <!-- CENTER CONTENT (Header + Scrollable Body) -->
        <main class="main-content flex-grow-1 d-flex flex-column">
            <!-- Constant Header (center only) -->
            <header class="main-header">
                <h2>@ViewData["PageHeader"]</h2>
            </header>

            <!-- Scrollable RenderBody -->
            <section class="content flex-grow-1 overflow-auto">
                @RenderBody()
            </section>
        </main>

        <!-- RIGHT SIDEBAR (Profile + Calendar + Notifs, shared across roles) -->
        <aside class="right-sidebar">
            <div id="rightSidebar" data-url="@Url.Action("RightSidebar", "Partials")">
                <div class="p-3 text-muted small">Loading…</div>
            </div>
        </aside>
    </div>

    <!-- JS libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
            integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>

    <!-- Validation (requires jQuery; order matters: jQuery -> validate -> unobtrusive) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"
            integrity="sha512-37T7leoNS06R80c8Ulq7cdCDU5MNQBwlYoy1TX/WUsLFC2eYNqtKlV0QjH7r8JpG/S0GUMZwebnVFLPd6SU5yg=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"
            integrity="sha512-o6XqxgrUsKmchwy9G5VRNWSSxTS4Urr4loO6/0hYdpWmFUfHqGzawGxeQGMDqYzxjY9sbktPbNlkIQJWagVZQg=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Optional libraries you already use -->
    <script src="https://kit.fontawesome.com/7a7c645416.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"
            referrerpolicy="no-referrer"></script>

    <!-- Your site-wide JS -->
    <script src="~/js/site.js" asp-append-version="true"></script>

    <!-- Hover label (global) JS -->
    <script src="~/js/hover-label.js" asp-append-version="true"></script>

    <!-- Floating cursor-follow label -->
    <div id="hoverLabel" role="status" aria-live="polite" aria-hidden="true"></div>

    @await RenderSectionAsync("Modals", required: false)
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
