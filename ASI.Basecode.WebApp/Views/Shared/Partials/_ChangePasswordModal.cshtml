@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
@{
    var token = Xsrf.GetAndStoreTokens(Context).RequestToken;
}

<!-- Change Password Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePwLabel"
     aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content pwm">
            <form id="changePwForm" method="post" action="/Account/ChangePasswordAjax"
                  autocomplete="off" novalidate>
                <input name="__RequestVerificationToken" type="hidden" value="@token" />

                <!-- Header -->
                <div class="modal-header border-0 pb-0">
                    <div>
                        <div class="pwm-eyebrow">SECURITY</div>
                        <h3 class="pwm-title" id="changePwLabel">Reset Password</h3>
                        <p class="pwm-sub">Create a new password for your account.</p>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>

                <!-- Body -->
                <div class="modal-body pt-2 pwm-narrow">
                    <div id="pwAlert" class="alert d-none" role="alert"></div>

                    <!-- Old Password -->
                    <div class="pwm-field">
                        <label class="pwm-label" for="oldPassword">Old Password</label>
                        <div class="pwm-inputwrap">
                            <i class="fa-solid fa-lock pwm-leading" aria-hidden="true"></i>
                            <input type="password" id="oldPassword" name="OldPassword"
                                   class="pwm-input form-control" required />
                            <button type="button" class="pwm-eye" data-target="oldPassword"
                                    aria-label="Show/Hide password">
                                <i class="fa-regular fa-eye"></i>
                            </button>
                        </div>
                        <div class="invalid-feedback d-block pwm-err"
                             data-for="oldPassword"></div>
                    </div>

                    <!-- New Password -->
                    <div class="pwm-field">
                        <label class="pwm-label" for="newPassword">New Password</label>
                        <div class="pwm-inputwrap">
                            <i class="fa-solid fa-lock pwm-leading" aria-hidden="true"></i>
                            <input type="password" id="newPassword" name="NewPassword"
                                   class="pwm-input form-control" minlength="8" required />
                            <button type="button" class="pwm-eye" data-target="newPassword"
                                    aria-label="Show/Hide password">
                                <i class="fa-regular fa-eye"></i>
                            </button>
                        </div>

                        <!-- Strength meter + helper -->
                        <div class="pwm-helper">
                            <small id="pwHint" class="text-success">
                                Use at least 8 characters with a mix of letters, numbers, and symbols.
                            </small>
                            <div class="pwm-meter">
                                <div id="pwMeterBar" class="pwm-meter-bar"></div>
                            </div>
                        </div>

                        <ul class="pwm-reqs" id="pwReqs" aria-live="polite">
                            <li data-rule="len">≥ 8 characters</li>
                            <li data-rule="mix">letters + numbers</li>
                            <li data-rule="sym">at least 1 symbol</li>
                        </ul>

                        <div class="invalid-feedback d-block pwm-err"
                             data-for="newPassword"></div>
                    </div>

                    <!-- Confirm New Password -->
                    <div class="pwm-field">
                        <label class="pwm-label" for="confirmPassword">Confirm New Password</label>
                        <div class="pwm-inputwrap">
                            <i class="fa-solid fa-lock pwm-leading" aria-hidden="true"></i>
                            <input type="password" id="confirmPassword" name="ConfirmPassword"
                                   class="pwm-input form-control" minlength="8" required />
                            <button type="button" class="pwm-eye" data-target="confirmPassword"
                                    aria-label="Show/Hide password">
                                <i class="fa-regular fa-eye"></i>
                            </button>
                        </div>
                        <div class="invalid-feedback d-block pwm-err"
                             data-for="confirmPassword"></div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="modal-footer border-0 pt-0">
                    <button type="button" class="btn btn-outline-secondary"
                            data-bs-dismiss="modal">
                        Cancel
                    </button>
                    <button type="submit" id="btnSubmitPw"
                            class="btn btn-primary pwm-submit" disabled>
                        Update Password
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<link rel="stylesheet" href="~/css/user-profile-modal.css" asp-append-version="true" />
<script src="~/js/change-password-modal.js" asp-append-version="true"></script>
