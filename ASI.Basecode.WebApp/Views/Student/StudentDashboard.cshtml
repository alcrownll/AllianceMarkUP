@model ASI.Basecode.Services.ServiceModels.StudentDashboardViewModel

@{
    Layout = "~/Views/Shared/Layouts/_MainLayout.cshtml";
    ViewData["Title"] = "Student Dashboard";
    ViewData["PageHeader"] = "Student Dashboard";

    var gwa = Model.CumulativeGwa ?? 0m;      // 1.00–5.00 (1.00 best)
    var gwaMax = Model.GwaScaleMax;           // 5.00
    var gwaBest = Model.GwaBest;              // 1.00
    var fill = (double)Math.Max(0m, Math.Min(1m, (gwaMax - gwa) / (gwaMax - gwaBest)));
}

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="~/css/student-dashboard.css" />
}

<div class="dash-wrap grid">
    <!-- KPI row -->
    <div class="grid kpis">
        <!-- Cumulative GWA -->
        <div class="card kpi kpi-gwa">
            <div class="kpi-body">
                <h4>Cumulative GWA</h4>
                <div class="value">@((Model.CumulativeGwa?.ToString("0.00")) ?? "—")</div>
                <div class="meta">
                    @if (Model.IsDeanListEligible)
                    {
                        <span>Eligible for <span class="badge">Dean’s List</span></span>
                    }
                    else
                    {
                        <span>Keep pushing! 💪</span>
                    }
                </div>
            </div>
            <div class="icon" aria-hidden="true"><i class="bi bi-mortarboard"></i></div>
        </div>

        <!-- Year and Program -->
        <div class="card kpi kpi-program">
            <div class="kpi-body">
                <h4>Year and Program</h4>
                <div class="value">@Model.YearLevel - @Model.Program</div>
                <div class="meta">@Model.CurrentSemesterName @Model.CurrentSchoolYear</div>
            </div>
            <div class="icon" aria-hidden="true"><i class="bi bi-diagram-3"></i></div>
        </div>

        <!-- Semester Units -->
        <div class="card kpi kpi-units">
            <div class="kpi-body">
                <h4>Semester Units</h4>
                <div class="value">@Model.CurrentTermUnits</div>
                <div class="meta">
                    @(Model.CurrentTermUnits <= 15 ? "Light Course Load"
                                        : Model.CurrentTermUnits <= 21 ? "Regular Load"
                                        : "Overload")
                </div>
            </div>
            <div class="icon" aria-hidden="true"><i class="bi bi-journal-text"></i></div>
        </div>
    </div>

    <!-- Academic Highlights -->
    <div class="card p24 grid hi">
        <div>
            <div class="hi-title">Academic Highlights</div>

            <div class="hi-inner">
                <!-- Donut -->
                <div class="ring-wrap">
                    <canvas id="gpaRing" class="ring-canvas"
                            data-gwa="@gwa"
                            data-fill="@fill"></canvas>
                    <div class="ring-legend">
                        <div>Best GWA: 1.00</div>
                        <div>Scale: 1.00–5.00</div>
                    </div>
                </div>

                <!-- Dynamic line -->
                <div class="chart-col">
                    <div class="tabs">
                        <div class="tab active" id="tabSem1">@Model.Sem1Label</div>
                        <div class="tab" id="tabSem2">@Model.Sem2Label</div>
                    </div>
                    <div class="chart-area">
                        <canvas id="termLine"
                                data-sem1='@Newtonsoft.Json.JsonConvert.SerializeObject(Model.Sem1Series ?? new decimal?[] { })'
                                data-sem2='@Newtonsoft.Json.JsonConvert.SerializeObject(Model.Sem2Series ?? new decimal?[] { })'>
                        </canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/js/student-dashboard.js"></script>
}
