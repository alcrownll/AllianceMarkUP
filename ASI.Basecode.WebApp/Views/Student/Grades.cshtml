@model ASI.Basecode.WebApp.Models.StudentGradesViewModel

@{
    Layout = "~/Views/Shared/Layouts/_MainLayout.cshtml";
    ViewData["Title"] = "Grades";
    ViewData["PageHeader"] = "Grades";
}

@section Styles {
    <link rel="stylesheet" href="~/css/student-grade.css" />
    <link rel="stylesheet" href="~/css/student-grade-print.css" />
}

@section Scripts {
    <script>
        function submitTermFilters() {
            const f = document.getElementById('termFilterForm');
            if (f) f.submit();
        }

        function printGrades() {
            window.print();
        }
    </script>
}

<div class="grades-page">

    @if (Model?.Grades == null || !Model.Grades.Any())
    {
        <div class="empty-state">
            <h3>No grades available yet</h3>
            <p>Once grades are uploaded to the system, they will appear here.</p>

            <!-- keep a bottom-only print button for empty-state -->
            <div style="margin-top:18px;">
                <button class="btn-pill" onclick="printGrades()">Print Records</button>
            </div>
        </div>
    }
    else
    {
        <!-- ================= SCREEN VERSION ================= -->
        <div class="grades-card no-print">
            <div class="grades-toolbar">
                <div class="toolbar-left">
                    <span class="toolbar-label">Select School Term</span>
                    <form id="termFilterForm" method="get" class="term-inline">
                        <label class="sr-only" for="selectSchoolTerm">School Year</label>
                        <select id="selectSchoolTerm" name="schoolYear" onchange="submitTermFilters()">
                            @foreach (var sy in Model.AvailableSchoolYears)
                            {
                                var isSelected = string.Equals(Model.SelectedSchoolYear, sy, System.StringComparison.OrdinalIgnoreCase);
                                <option value="@sy" selected="@(isSelected ? "selected" : null)">@sy</option>
                            }
                        </select>

                        <label class="sr-only" for="selectSemester">Semester</label>
                        <select id="selectSemester" name="semester" onchange="submitTermFilters()">
                            @foreach (var sem in Model.AvailableSemesters)
                            {
                                var isSelected = string.Equals(Model.SelectedSemester, sem, System.StringComparison.OrdinalIgnoreCase);
                                <option value="@sem" selected="@(isSelected ? "selected" : null)">@sem</option>
                            }
                        </select>

                        <!-- NEW: print icon beside dropdowns (same UX as Study Load) -->
                        <button type="button" class="iconbtn" title="Print Grades" onclick="printGrades()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                <path d="M6 9V3h12v6M6 17v4h12v-4M6 9h12m-1 4h2a2 2 0 0 0 2-2v-1a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v1a2 2 0 0 0 2 2h2"
                                      fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <span class="sr-only">Print</span>
                        </button>
                    </form>
                </div>

                <!-- REMOVED the big right-side Print Records button -->
            </div>

            <div class="info-grid">
                <div class="info-left">
                    <div class="info-line"><small>Name :</small><b>@Model.StudentName</b></div>
                    <div class="info-line"><small>Program :</small><b>@Model.Program</b></div>
                    <div class="info-line"><small>Year Level :</small><b>@Model.YearLevel</b></div>
                </div>
                <div class="info-right">
                    <div class="info-line"><small>School Year :</small><b>@(string.IsNullOrWhiteSpace(Model.SelectedSchoolYear) ? Model.SchoolYear : Model.SelectedSchoolYear)</b></div>
                    <div class="info-line"><small>Semester :</small><b>@(Model.SelectedSemester ?? Model.Semester)</b></div>
                    <div class="info-line"><small>GPA :</small><b>@(Model.Gpa?.ToString("0.00") ?? "—")</b></div>
                </div>
            </div>

            <div class="grades-table-wrapper">
                <table class="grades-table">
                    <thead>
                        <tr>
                            <th>Subject</th>
                            <th>Description</th>
                            <th>Instructor</th>
                            <th>Type</th>
                            <th>Units</th>
                            <th>Prelim</th>
                            <th>Midterm</th>
                            <th>Semi-Final</th>
                            <th>Final</th>
                            <th>Remarks</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Grades)
                        {
                            var isPassed = !string.IsNullOrWhiteSpace(item.Remarks) && item.Remarks.ToUpper().Contains("PASS");
                            <tr>
                                <td>@item.SubjectCode</td>
                                <td>@item.Description</td>
                                <td>@item.Instructor</td>
                                <td>@item.Type</td>
                                <td>@item.Units</td>
                                <td>@(item.Prelims?.ToString("0.0") ?? "—")</td>
                                <td>@(item.Midterm?.ToString("0.0") ?? "—")</td>
                                <td>@(item.SemiFinal?.ToString("0.0") ?? "—")</td>
                                <td>@(item.Final?.ToString("0.0") ?? "—")</td>
                                <td class="@(isPassed ? "remarks-pass" : "remarks-fail")">@((item.Remarks ?? "").ToUpper())</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- Moved the full-size print button to the bottom (like you asked) -->
            <div class="card-bottom">
                <button class="btn-pill" type="button" onclick="printGrades()">Print Records</button>
            </div>
        </div>
        <!-- ================= /SCREEN VERSION ================= -->
        <!-- ================= PRINT VERSION ================= -->
        <div id="gradesPrintArea" class="print-sheet only-print">
            <div class="sheet-header">
                <img src="~/img/uc-logo.png" alt="University of Cebu" class="logo-left" />
                <div class="header-text">
                    <div class="u-name">UNIVERSITY OF CEBU LAPU-LAPU AND MANDAUE</div>
                    <div>A.C. Cortes Avenue,<br />Mandaue City, Philippines</div>
                    <div>Website: ccs-lm.uc.ude.ph</div>
                    <div>Email: ccs.lm@uc.edu.ph</div>
                </div>
                <img src="~/img/ccs-crest.png" alt="CCS" class="logo-right" />
            </div>

            <div class="title">GRADES</div>
            <div class="sub-title">
                @(Model.SelectedSemester ?? Model.Semester), S.Y. @(string.IsNullOrWhiteSpace(Model.SelectedSchoolYear) ? Model.SchoolYear : Model.SelectedSchoolYear)
            </div>
            <div class="dept">College of Computer Studies</div>
            <div class="prog">@Model.Program</div>

            <div class="info-grid">
                <div class="lbl">Name</div><div class="val">: @Model.StudentName</div>
                <div class="lbl">School Year</div><div class="val">: @(string.IsNullOrWhiteSpace(Model.SelectedSchoolYear) ? Model.SchoolYear : Model.SelectedSchoolYear)</div>
                <div class="lbl">Semester</div><div class="val">: @(Model.SelectedSemester ?? Model.Semester)</div>
                <div class="lbl">Year Level</div><div class="val">: @Model.YearLevel</div>
                <div class="lbl">GPA</div><div class="val">: @(Model.Gpa?.ToString("0.00") ?? "—")</div>
            </div>

            <hr class="sep" />

            <table class="grid">
                <colgroup>
                    <col style="width:12%">
                    <col style="width:26%">
                    <col style="width:16%">
                    <col style="width:6%">
                    <col style="width:6%">
                    <col style="width:7%">
                    <col style="width:7%">
                    <col style="width:7%">
                    <col style="width:7%">
                    <col style="width:6%">
                </colgroup>
                <thead>
                    <tr>
                        <th>Subject</th>
                        <th>Description</th>
                        <th>Instructor</th>
                        <th>Type</th>
                        <th>Units</th>
                        <th>Prelim</th>
                        <th>Midterm</th>
                        <th>Semi-Final</th>
                        <th>Final</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Grades?.Any() == true)
                    {
                        foreach (var item in Model.Grades)
                        {
                            var isPassed = !string.IsNullOrWhiteSpace(item.Remarks) && item.Remarks.ToUpper().Contains("PASS");
                            <tr>
                                <td>@item.SubjectCode</td>
                                <td>@item.Description</td>
                                <td>@item.Instructor</td>
                                <td>@item.Type</td>
                                <td>@item.Units</td>
                                <td>@(item.Prelims?.ToString("0.0") ?? "—")</td>
                                <td>@(item.Midterm?.ToString("0.0") ?? "—")</td>
                                <td>@(item.SemiFinal?.ToString("0.0") ?? "—")</td>
                                <td>@(item.Final?.ToString("0.0") ?? "—")</td>
                                <td class="@(isPassed ? "remarks-pass" : "remarks-fail")">@((item.Remarks ?? "").ToUpper())</td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr><td colspan="10" class="no-rows">No grades found.</td></tr>
                    }
                </tbody>
            </table>

            <div class="footer-row">
                <span><strong>Total Units:</strong> @Model.Grades.Sum(g => g.Units)</span>
            </div>

            <div class="watermark">OFFICIAL</div>
        </div>
        <!-- ================= /PRINT VERSION ================= -->
    }
</div>
