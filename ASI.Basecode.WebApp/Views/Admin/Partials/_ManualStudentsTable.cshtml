@using ASI.Basecode.Data.Models
@model IEnumerable<Student>

@{
    int page = (int)(ViewBag.Page ?? 1);
    int pageSize = (int)(ViewBag.PageSize ?? 10);
    int total = (int)(ViewBag.Total ?? 0);
    int pages = Math.Max(1, (int)Math.Ceiling(total / (double)pageSize));

    var start = total == 0 ? 0 : ((page - 1) * pageSize) + 1;
    var end = Math.Min(page * pageSize, total);
}

@if (!Model.Any())
{
    <div class="alert alert-warning mb-2">No students found outside the selected block.</div>
}
else
{
    <div class="table-responsive">
        <table class="table table-sm align-middle">
            <thead>
                <tr>
                    <th style="width:36px;">
                        <input id="selectAllStudents" type="checkbox" class="form-check-input"
                            aria-label="Select all students" />
                    </th>
                    <th>Name</th>
                    <th>Program</th>
                    <th>Year</th>
                    <th>Section</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var s in Model)
                {
                    var full = (s.User != null)
                    ? $"{(s.User.LastName ?? "").ToUpper()}, {s.User.FirstName}"
                    : "(no user)";

                    <tr>
                        <td>
                            <input type="checkbox" class="form-check-input student-checkbox" name="SelectedStudentIds"
                                value="@s.StudentId" aria-label="Select @full" />
                        </td>
                        <td>@full</td>
                        <td>@(s.Program ?? "")</td>
                        <td>@(s.YearLevel ?? "")</td>
                        <td>@(s.Section ?? "")</td>
                        <td>@(s.User?.AccountStatus ?? "")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="d-flex justify-content-between align-items-center mt-2">
        <div class="small text-muted">
            Showing @start–@end of @total
        </div>

        <nav aria-label="Manual students pagination">
            <ul class="pagination pagination-sm mb-0">
                <li class="page-item @(page <= 1 ? "disabled" : "")">
                    <a class="page-link js-page" href="#" data-page="@(Math.Max(1, page - 1))">Prev</a>
                </li>

                @for (var i = 1; i <= pages; i++)
                {
                    <li class="page-item @(i == page ? "active" : "")">
                        <a class="page-link js-page" href="#" data-page="@i">@i</a>
                    </li>
                }

                <li class="page-item @(page >= pages ? "disabled" : "")">
                    <a class="page-link js-page" href="#" data-page="@(Math.Min(pages, page + 1))">Next</a>
                </li>
            </ul>
        </nav>
    </div>

    <style>
        /* Row highlight when a student is selected */
        #manualTableHost tr:has(.student-checkbox:checked) {
            background: rgba(37, 99, 235, .06);
        }
    </style>
}