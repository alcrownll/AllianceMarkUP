@* Step 1: Program Basic Details *@
<div class="modal fade" id="addProgramModal" tabindex="-1" aria-labelledby="addProgramLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content shadow">
            <div class="modal-header">
                <h5 class="modal-title" id="addProgramLabel">Add Program — Basic Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <form id="addProgramForm" novalidate>
                <div class="modal-body">
                    <p class="text-muted small mb-3">
                        Step 1 of 2: Enter the program code and name before proceeding to build the curriculum.
                    </p>

                    <div class="row g-3">
                        <!-- Program Code -->
                        <div class="col-sm-5">
                            <label class="form-label">Code <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="Code" placeholder="BSCS" maxlength="20" required>
                            <div class="invalid-feedback">Program code is required.</div>
                        </div>

                        <!-- Program Name -->
                        <div class="col-sm-7">
                            <label class="form-label">Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="Name"
                                   placeholder="Bachelor of Science in Computer Science"
                                   maxlength="150" required>
                            <div class="invalid-feedback">Program name is required.</div>
                        </div>

                        <!-- Notes -->
                        <div class="col-12">
                            <label class="form-label">Description / Notes</label>
                            <textarea class="form-control" name="Notes" rows="2"
                                      placeholder="Brief description or internal notes"></textarea>
                        </div>

                        <!-- Status -->
                        <div class="col-12 mt-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="IsActive" name="IsActive" disabled>
                                <label class="form-check-label" for="IsActive">
                                    Active (will be set after curriculum is completed)
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- inline error -->
                    <div id="addProgramError" class="text-danger small mt-2" style="display:none;"></div>

                    <!-- store program id for step 2 -->
                    <input type="hidden" id="ProgramId" />
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="btnNextProgram">Next</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // In-memory prospectus (Option C). If you already defined this elsewhere, keep one copy only.
    window.prospectus = window.prospectus || {
      code: "", name: "", notes: "",
      years: [
        { terms: [ { courses: [] }, { courses: [] } ] },
        { terms: [ { courses: [] }, { courses: [] } ] },
        { terms: [ { courses: [] }, { courses: [] } ] },
        { terms: [ { courses: [] }, { courses: [] } ] }
      ]
    };

    (function () {
      const form   = document.getElementById('addProgramForm');
      const btn    = document.getElementById('btnNextProgram');
      const errEl  = document.getElementById('addProgramError');

      function showErr(m){ errEl.textContent = m||""; errEl.style.display = m ? "block" : "none"; }

      btn?.addEventListener('click', () => {
        showErr('');

        // HTML5 validation only
        if (!form.checkValidity()) {
          form.classList.add('was-validated');
          return;
        }

        // Copy fields into client-side state (NO server call here)
        const fd = new FormData(form);
        window.prospectus.code  = (fd.get('Code')  || '').toString().trim();
        window.prospectus.name  = (fd.get('Name')  || '').toString().trim();
        window.prospectus.notes = (fd.get('Notes') || '').toString();

        // ---- BRIDGE: mirror into PROGRAM_DRAFT for Step 2 + Finish ----
        window.PROGRAM_DRAFT = window.PROGRAM_DRAFT || { program: { code:'', name:'', notes:'', years: 4 }, years: [] };
        if (!Array.isArray(window.PROGRAM_DRAFT.years) || window.PROGRAM_DRAFT.years.length === 0) {
          window.PROGRAM_DRAFT.years = [
            { year: 1, terms: [ { term: 1, courses: [] }, { term: 2, courses: [] } ] },
            { year: 2, terms: [ { term: 1, courses: [] }, { term: 2, courses: [] } ] },
            { year: 3, terms: [ { term: 1, courses: [] }, { term: 2, courses: [] } ] },
            { year: 4, terms: [ { term: 1, courses: [] }, { term: 2, courses: [] } ] }
          ];
        }
        window.PROGRAM_DRAFT.program.code  = window.prospectus.code;
        window.PROGRAM_DRAFT.program.name  = window.prospectus.name;
        window.PROGRAM_DRAFT.program.notes = window.prospectus.notes;
        window.PROGRAM_DRAFT.program.years = 4; // adjust if you add a Years selector later
        // ---------------------------------------------------------------

        // Fill Step 2 header summary
        const sumCode = document.getElementById('sumCode');
        const sumName = document.getElementById('sumName');
        if (sumCode) sumCode.textContent = window.prospectus.code || '—';
        if (sumName) sumName.textContent = window.prospectus.name || '—';

        // Open Step 2
        const m1 = bootstrap.Modal.getOrCreateInstance(document.getElementById('addProgramModal'));
        const m2 = bootstrap.Modal.getOrCreateInstance(document.getElementById('programProspectusModal'));
        m1.hide();
        setTimeout(() => m2.show(), 150);

        // If you have a render function for the term tables, call it
        if (typeof renderAllTermTables === 'function') renderAllTermTables();

        // (Optional) quick debug in console
        // console.log('prospectus:', window.prospectus);
        // console.log('PROGRAM_DRAFT.program:', window.PROGRAM_DRAFT.program);
      });
    })();
</script>

