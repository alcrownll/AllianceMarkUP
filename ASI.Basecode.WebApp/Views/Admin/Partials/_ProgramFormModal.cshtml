@* ADD PROGRAM MODAL *@
<div class="modal fade" id="addProgramModal" tabindex="-1" aria-labelledby="addProgramLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md">
        <div class="modal-content shadow-sm border-0 rounded-3">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title fw-semibold" id="addProgramLabel">
                    <i class="bi bi-journal-plus me-2"></i> Add Program
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <form id="addProgramForm" novalidate>
                <div class="modal-body p-4">
                    <p class="text-muted small mb-4">
                        Fill in the program’s basic details. Once added, you can assign courses to it.
                    </p>

                    <div class="row g-3">
                        <!-- Program Code -->
                        <div class="col-sm-5">
                            <label class="form-label fw-medium">Program Code <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="Code" placeholder="BSCS" maxlength="20" required>
                            <div class="invalid-feedback">Program code is required.</div>
                        </div>

                        <!-- Program Name -->
                        <div class="col-sm-7">
                            <label class="form-label fw-medium">Program Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="Name"
                                   placeholder="Bachelor of Science in Computer Science"
                                   maxlength="150" required>
                            <div class="invalid-feedback">Program name is required.</div>
                        </div>
                    </div>

                    <!-- Inline error message -->
                    <div id="addProgramError" class="text-danger small mt-3" style="display:none;"></div>
                </div>

                <div class="modal-footer border-0 pt-0">
                    <button type="button" class="btn btn-outline-secondary rounded-pill px-4" data-bs-dismiss="modal">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary rounded-pill px-4" id="btnAddProgram">
                        <i class="bi bi-plus-lg me-1"></i> Add Program
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    (function () {
        const form  = document.getElementById('addProgramForm');
        const errEl = document.getElementById('addProgramError');
        const btn   = document.getElementById('btnAddProgram');
        const showErr = msg => { errEl.textContent = msg || ''; errEl.style.display = msg ? 'block' : 'none'; };

        form.addEventListener('submit', async (ev) => {
            ev.preventDefault();
            showErr('');
            form.classList.remove('was-validated');

            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Saving...';

            try {
                const fd = new FormData();
                fd.append('code', (form.querySelector('[name="Code"]').value || '').trim());
                fd.append('name', (form.querySelector('[name="Name"]').value || '').trim());
                fd.append('notes', ''); // optional, backend accepts it

                // Direct endpoint, matches [Route("admin/programs")] + [HttpPost("create")]
                const res = await fetch('/admin/programs/create', {
                    method: 'POST',
                    body: fd
                });

                if (!res.ok) throw new Error(`Server returned ${res.status}`);

                const data = await res.json();

                if (data.ok) {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addProgramModal'));
                    modal.hide();
                    form.reset();

                    // Refresh program list if a loader exists
                    if (typeof loadProgramTable === 'function') loadProgramTable();
                } else {
                    showErr(data.message || 'Failed to add program.');
                }
            }
            catch (err) {
                console.error(err);
                showErr('An unexpected error occurred. Please try again.');
            }
            finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-plus-lg me-1"></i> Add Program';
            }
        });
    })();
</script>
