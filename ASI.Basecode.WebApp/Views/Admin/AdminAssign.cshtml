@using ASI.Basecode.Data.Models
@model IEnumerable<AssignedCourse>

@{
    ViewData["Title"] = "Manage Assigned Courses";
    Layout = "~/Views/Shared/Layouts/_MainLayout.cshtml";
    ViewData["PageHeader"] = "Assign Courses";
    var q = (string)(ViewData["Query"] ?? "");
}

<link rel="stylesheet" href="~/css/manage-accounts.css" />

<div class="admin-accounts-container">
    <div class="card admin-accounts-card">

        <div class="card-body">

            <div class="d-flex justify-content-between align-items-end gap-3 flex-wrap w-100 mb-3">
                <form asp-action="Index" method="get" class="d-flex" style="max-width:600px; width:100%;">
                    <div class="input-group w-100">
                        <span class="input-group-text bg-white border-end-0">
                            <i class="bi bi-search"></i>
                        </span>
                        <input name="q" value="@q" type="text" class="form-control border-start-0"
                               placeholder="Search by Course Code, EDP Code, or Teacher…" autocomplete="off" />
                    </div>
                </form>

                <div class="d-flex align-items-center" style="gap:.5rem;">
                    <a class="btn btn-primary rounded-pill px-4" asp-controller="AdminAssign" asp-action="Assign">
                        <span class="me-2">+</span> Assign Course
                    </a>
                </div>
            </div>

            <div class="position-fixed top-0 end-0 p-3" style="z-index:1080;">
                <div id="liveToastContainer">
                    @if (TempData["Ok"] != null)
                    {
                        <div class="toast align-items-center text-bg-success border-0 js-auto-toast"
                             role="status" aria-live="polite" aria-atomic="true"
                             data-bs-delay="4000">
                            <div class="d-flex">
                                <div class="toast-body">
                                    @TempData["Ok"]
                                </div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto"
                                        data-bs-dismiss="toast" aria-label="Close"></button>
                            </div>
                        </div>
                    }
                    @if (TempData["Error"] != null)
                    {
                        <div class="toast align-items-center text-bg-danger border-0 js-auto-toast"
                             role="alert" aria-live="assertive" aria-atomic="true"
                             data-bs-delay="5000">
                            <div class="d-flex">
                                <div class="toast-body">
                                    @TempData["Error"]
                                </div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto"
                                        data-bs-dismiss="toast" aria-label="Close"></button>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <div class="table-wrap mt-2">
                <table class="accounts-table table align-middle">
                    <thead class="table-light">
                        <tr>
                            <th class="text-center" style="width:140px;">EDP Code</th>
                            <th class="text-center" style="width:160px;">Course Code</th>
                            <th class="text-center" style="width:140px;">Type</th>
                            <th class="text-start">Teacher</th>
                            <th class="text-end" style="width:210px;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            foreach (var ac in Model)
                            {
                                var teacherName = $"{ac.Teacher?.User?.FirstName} {ac.Teacher?.User?.LastName}".Trim();
                                var modalId = $"confirmDelete-{ac.AssignedCourseId}";
                                <tr>
                                    <td class="text-center"><span class="chip">@ac.EDPCode</span></td>
                                    <td class="text-center">@ac.Course?.CourseCode</td>
                                    <td class="text-center">@ac.Type</td>
                                    <td class="text-start">@teacherName</td>
                                    <td class="text-end">
                                        <div class="row-actions">
                                            <a class="btn btn-primary btn-sm rounded-pill"
                                               asp-action="View" asp-route-id="@ac.AssignedCourseId">View</a>

                                            <button type="button"
                                                    class="btn btn-danger btn-sm rounded-pill"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#@modalId">
                                                Delete
                                            </button>
                                        </div>
                                    </td>
                                </tr>

                                @await Html.PartialAsync("~/Views/Admin/Partials/_ConfirmDeleteAssignedCourse.cshtml", ac)
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="5" class="empty-row">No assigned courses found.</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script src="~/js/admin-assign.js" asp-append-version="true"></script>
